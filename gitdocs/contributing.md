# Contributing

- [Основное](#%D0%BE%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D0%BE%D0%B5)
- [Создание Pull Request](#%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5-pull-request)
- [Описания коммитов](#%D0%BE%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BA%D0%BE%D0%BC%D0%BC%D0%B8%D1%82%D0%BE%D0%B2)
- [Continuous Integration](#continuous-integration)
- [Процесс прохождения Code Review](#%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81-%D0%BF%D1%80%D0%BE%D1%85%D0%BE%D0%B6%D0%B4%D0%B5%D0%BD%D0%B8%D1%8F-code-review)
- [Договоренности по написанию кода](#%D0%B4%D0%BE%D0%B3%D0%BE%D0%B2%D0%BE%D1%80%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8-%D0%BF%D0%BE-%D0%BD%D0%B0%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D1%8E-%D0%BA%D0%BE%D0%B4%D0%B0)
  - [Правила именования переменных и функций](#%D0%BF%D1%80%D0%B0%D0%B2%D0%B8%D0%BB%D0%B0-%D0%B8%D0%BC%D0%B5%D0%BD%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BF%D0%B5%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%BD%D1%8B%D1%85-%D0%B8-%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%B9)
  - [Написание функций](#%D0%BD%D0%B0%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D0%B5-%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%B9)
  - [Общие правила](#%D0%BE%D0%B1%D1%89%D0%B8%D0%B5-%D0%BF%D1%80%D0%B0%D0%B2%D0%B8%D0%BB%D0%B0)
- [Разработка безопасного кода](#%D1%80%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B0-%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D0%B3%D0%BE-%D0%BA%D0%BE%D0%B4%D0%B0)

# Основное

- Официальные языки нашего сообщества - русский и английский. Коммиты, пулл реквесты, иссуи - все можно писать на обоих языках.
- Мы ожидаем, что вы поможете нам поддерживать код, который вы добавили. Скорее всего мы к вам обратимся в случае возникновения каких-то проблем, связанных с вашими изменениями, в том числе рантаймами или багами.

# Создание Pull Request

Здесь приведен небольшой чек-лист важных вещей, на которые обязательно нужно обращать внимание при открытии Pull Request-а. Пренебрежение этим разделом может увеличить время проверки ваших изменений и принятия в сборку вплоть до бесконечности!

- **Заголовок ПРа - цель его изменений.** У любого Pull Request должна быть конкретная цель, которая должна быть указана в заголовке. Pull Request не должен содержать изменений, которые не относятся к указанной цели. Если цель Pull Request-а слишком большая, чтобы уместить её в одном заголовке - подумайте над тем, чтобы разбить свой Pull Request на более мелкие части.
- **Изменения востребованы.** Перед началом разработки убедитесь, что то, что вы хотите сделать - востребовано и будет принято. Для этого нужно либо обсудить изменения с текущими разработчиками. Также изменения очевидно востребованы, если на них есть соответствующий иссуй, проверенный командой. Чтобы ваши изменения ТОЧНО были приняты - лучше убедиться в том, что у вас есть соответстующий иссуй с подтверждением, так как любые договоренности в средствах коммуникации могут потеряться или оказаться неактуальными.
- **Подробное описание.** В описании Pull Request-а должно быть подробное описание того, зачем он нужен и что в нем происходит. Pull Request не должен содержать изменений, о которых ничего не написано в описании.
- **Привяжите иссуи.** Если Pull Request решает какие-то иссуи, то они должны быть указаны в описании специальным образом, например, `close #23`, чтобы Github смог их автоматически привязать к вашим изменениям. Подробнее можно почитать тут: https://help.github.com/articles/closing-issues-via-commit-messages.
- **Проверьте свой код.** Открывайте Pull Request только если вы уверены в его работоспособности. Это означает, что вы проверили каждую строчку своих изменений, а также **проверили свои изменения локально**, запустив эксперимент на своем компьютере. Если что-то невозможно проверить полностью или вы считаете, что на какую-то часть изменений нужно обратить пристальное внимание проверяющих, то укажите это отдельно в описании. Конечно мы также будем проверять ваши изменения, но вы не должны полагаться на то, что ваши баги заметит кто-то другой и исправит за вас.
- **Ваш код соответствует принятым договоренностям по написанию кода.** Подробнее смотрите раздел "Договоренности по написанию кода" ниже.

# Описания коммитов

Главная цель правильного именования и описания коммитов - упростить процесс чтения истории git. Чем понятнее написаны комментарии к коммитам, тем проще находить причины багов.

Коммиты следует именовать по следующей схеме:

```
action(area): short one-line description

long multiline description

related items
```

- **action** - тип действия, которое совершается в коммите. Например, fix, feat, refact, tweak, delete, docs и т.д. Отвечает на вопрос "Что делаем?"
- **area** - область кода, в которой происходит действие. Например, metrics, LM, architecture, ops и т.д.
- **related items** - иссуи, которых касается коммит. Еще какие-то ссылки, которые могут относиться к PR-у. В случае иссуев обязательно использование [ключевых слов Github](https://help.github.com/articles/closing-issues-via-commit-messages) для автоматического связывания коммита с иссуями.

Пример хорошего описания коммита:

```
feat(metrics): more LM-friendly metrics

The new metrics show new areas for improvement in the current model.
Shows new problems of baseline solution.

PR #1
close #1
```

Еще раз отдельно обратим внимание на то, что коммиты можно писать на русском языке по той же схеме. Однако `area` и разные ключевые слова обязательно нужно писать на английском языке, согласно тому, как оно пишется в коде, чтобы всем было понятно какой части кода касаются ваши изменения.

# Continuous Integration

Каждый Pull Request проходит проверку на несколько вещей:

- Соотвествие кодовый базы стандарту написанию кода.
- Ошибка найденные статическими анализаторами кода.

Ошибки проверяются на каждый новый коммит один раз.

# Договоренности по написанию кода

## Правила именования переменных и функций

### Имена должны передавать намерения программиста

Имя переменной, функции или типа должно сообщить, почему эта переменная существует, что она делает и как используется. Если имя требует дополнительных комментариев, значит, оно не передает намерений программиста. Лучше написать, что именно измеряется и в каких именно единицах.

Не бойтесь использовать длинные имена: длинное содержательное имя лучше короткого невразумительного.

Пример хорошего названия переменной: days_since_creation;
Цель: убрать неочевидность.

### Избегайте неинформативных слов в названиях

Неинформативные слова избыточны. Слово variable никогда не должно встречаться в именах переменных. Слово object никогда не должно встречаться в именах объектов. Чем имя name_string лучше name? Разве имя может быть, скажем, вещественным числом?

### Избегайте сокращений, старайтесь выбирать удобопроизносимые имена

russian_to_utf намного лучше rustoutf.

### Выбирайте имена, удобные для поиска

Чем дольше время жизни переменной - тем длиннее должно быть её название. Однобуквенные имена могут использоваться только для локальных переменных в коротких методах.

### Имена типов

Имена типов должны представлять собой существительные и их комбинации: traitor, profession, id_card и request_parser. Старайтесь не использовать в именах классов такие слова, как manager, processor, data или info. Имя класса не должно быть глаголом.

### Имена функций

Имена методов представляют собой глаголы или глагольные словосочетания: explode_station, delete_ian, save и т. д. Методы чтения/записи образуются из значения и префикса get, set и is.

## Написание функций

### Компактность

- **Первое правило:** функции должны быть компактными.
- **Второе правило:** функции должны быть еще компактнее.

Серьезные программисты работающие в реальном мире ценой многих проб и ошибок вывели, что функции должны быть очень маленькими. Желательно, чтобы длина фукнции не превышала 20 строк. В условиях разработки SS13 кому-то это может показаться излишним, но даже в наших проектах можно заметить, что чем длиннее функция тем сложнее её поддерживать, тем больше в ней багов и тем меньшее количество людей хочет в неё лезть и с ней разбираться.

### Правило одной операции

Функция должна выполнять только одну операцию. Она должна выполнять ее хорошо. И ничего другого она делать не должна. Если функция выполняет только те действия, которые находятся на одном уровне под объявленным именем функции, то эта функция выполняет одну операцию.

### Функция не должна разбиваться на секции

Функцию, выполняющую только одну операцию, невозможно осмысленно разделить на секции.

### Разделение команд и запросов

Функция должна что-то делать или отвечать на какой-то вопрос, но не одновременно. Либо функция изменяет состояние объекта, либо возвращает информацию об этом объекте. Совмещение двух операций часто создает путаницу.

## Общие правила

### Комментарии

Закомметированный код запрещен.

Запрещены комментарии отвечающие на вопрос "Что делает этот код?". Вместо этого используете методы для увеличения читаемости кода выше, чтобы код объяснял себя сам. Разрешены комментарии отвечающие на вопрос "Зачем этот код нужен?".

Также можно писать комментарии типа "TODO" и "FIXME".

### Не избавляйтесь от проверки типов

Используйте type hinting, статические анализаторы могут подсказать, если в вашу функцию подается не тот объект.

### Избегайте дублирования кода

Когда вы копируете один и тот же код в разные места - появляется необходимость одинаково поддерживать этот код в двух местах. При любом изменении оригинального кода надо помнить о копии этого кода в другом месте и зачастую вносить изменения и туда.

Чтобы избежать подобных проблем используйте наследование объектов друг от друга или же просто вынесите необходимую логику в отдельную функцию.

### Не используйте магические значения

В коде не должно быть "брошенных" числовых/строчных или каких-либо еще значений, смысл которых неясен из контекста или которые могут быть переиспользованы. Определяйте их в файле глобальный переменных, если они нужны в глобальном скоупе, или создавайте локальную переменную с понятным названием.

Идеально используйте .yaml файлы для магических значений.

### Избегайте глобальных переменных (outer of scope)

Главная проблема глобальных переменных в том, что чем больше они используются, тем сложнее понять логику их изменения и поведения процессов, которые от них зависят. Поэтому глобальные переменные лучше вовсе не использовать.

## Разработка безопасного кода

- Всегда относитель к пользовательскому вводу так, как будто он намеренно пытается все сломать. Проверяйте пользовательский ввод на все случаи, которые не соответсвуют ожиданиям вашего кода. Для чисел проверяйте границы, для строк используйте escape-функции.
- Обязательно эскейптьте все команды к базе данных.
- Используйте безопасные методы для загрузки и выгрузки артефактов (пример, safetensors вместо pickle)
